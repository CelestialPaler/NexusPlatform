# Nexus 开发指南 (Developer Guide)

> **版本**: 1.0
> **技术栈**: React, Flask, PyWebview, Plotly

## 1. 开发环境治理

### 1.1 Python 环境 (Super Venv)
*   **规则**: 严禁在项目根目录创建虚拟环境。
*   **位置**: `%USERPROFILE%\.venvs\negentropy`
*   **管理**: 仅通过 `reinit_env.ps1` 脚本安装依赖，禁止手动 `pip install`。

### 1.2 前端环境
*   **工具**: pnpm (推荐) 或 npm。
*   **规则**: `node_modules` 必须位于本地非 OneDrive 目录。

## 2. 目录结构

| 路径                                    | 说明                            |
| :-------------------------------------- | :------------------------------ |
| `backend/app.py`                        | 后端主入口，定义 API路由        |
| `backend/managers/`                     | 业务逻辑层 (Clean Architecture) |
| `frontend/src/components/`              | UI 组件库                       |
| `frontend/src/components/nexus-charts/` | **NexusCharts** 图表库          |
| `frontend/src/components/nexus-ui/`     | **NexusUI** 基础组件库          |

## 3. 贡献规范 (Contribution)

### 3.1 Git 提交规范
必须遵循 `Type(Scope): Subject` 格式 (参考 `标准 04`)。
*   `feat(界面): 新增图表组件`
*   `fix(核心): 修复 Ping 超时问题`

### 3.2 代码风格
*   **缩进**: 统一 4 空格 (Python) / 4 空格 (JS/JSX)。
*   **换行**: LF (推荐) 或 Auto。
*   **组件开发**: 
    *   新组件必须适配 `ThemeContext` (深色模式)。
    *   通用组件放入 `nexus-ui`，业务组件放入 `components`。

## 4. 扩展开发
### 4.1 如何新增一个页面
1. 在 `frontend/src/components/` 下创建 `MyPanel.jsx`。
2. 在 `frontend/src/translations.js` 注册多语言 Key。
3. 在 `App.jsx` 中导入并添加到 `render()` 路由。

### 4.2 如何封装新图表
参考 `nexus-charts/BaseChart.jsx`，继承基础配置，封装 `react-plotly.js`。

## 5. 构建与发布 (Build & Release)

### 5.1 编译可执行程序
运行 Task: `Nexus: 构建Release版本 (Output Release)` 或执行脚本 `scripts/30_build_release.ps1`。
生成的 `NexusPlatform.exe` 将位于项目根目录的 `bin/release/` 下（即 `nexus-platform` 的上级目录）。

### 5.2 调试版本构建 (Debug Build)
运行 Task: `Nexus: 构建Debug版本` 或执行脚本 `scripts/20_build_debug.ps1`。
*   **特性**: 带有控制台窗口 (Console)，方便查看日志。
*   **位置**: `bin/debug/` (项目根目录)。

### 5.3 绕过 Smart App Control (SAC) 拦截
Windows 11 的 SAC 机制会拦截未签名的程序。在开发环境分发时，需执行自签名流程：

1.  **执行签名脚本**:
    ```powershell
    # 自动创建 "Nexus Networks" 证书并签名
    ./scripts/40_sign_release.ps1
    ```
2.  **添加本地信任** (仅需一次):
    *   进入 `bin/release/` 目录。
    *   双击生成的 **`NexusNetworks.cer`**。
    *   选择 `安装证书` -> `本地计算机` -> `将所有的证书都放入下列存储` -> `受信任的根证书颁发机构`。

完成上述步骤后，SAC 即会将 Nexus Networks 视为可信来源。
